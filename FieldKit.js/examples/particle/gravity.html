<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="en-UK" />
    <title>FieldKit.js: Gravity</title>
	
	<!-- <script src="../../build/fieldkit.js" type="text/javascript" charset="utf-8" ></script> -->
	
	<script src="../../src/Package.js" type="text/javascript"></script>
	
	<script src="../../src/math/Math.js" type="text/javascript"></script>
	<script src="../../src/math/Vec2.js" type="text/javascript"></script>
	<script src="../../src/math/Vec3.js" type="text/javascript"></script>
	
	<script src="../../src/particle/System.js" type="text/javascript"></script>	
	<script src="../../src/particle/Flock.js" type="text/javascript"></script>	
	<script src="../../src/particle/Particle.js" type="text/javascript"></script>
	<script src="../../src/particle/Emitter.js" type="text/javascript"></script>	
	<script src="../../src/particle/Behaviour.js" type="text/javascript"></script>		
	
	<style type="text/css">
		#stage canvas {
			border: 2px solid black;
			display: block;
		}
	</style>
  </head>
  <body>
	<h1>FieldKit.js: Gravity</h1>
	<div id="stage"></div>
	<script type="text/javascript">
		// settings
		var width = 640
		var height = 480
		
		// init
		var stage = document.getElementById('stage')
		var canvas = document.createElement("canvas")
	 	var context = canvas.getContext('2d')
		canvas.width = width
		canvas.height = height
		stage.appendChild(canvas)
	
		var ps = new fk.particle.System(30, 30)
		var flock = new fk.particle.Flock()
		ps.add(flock)
		
		flock.emitter.interval = 10
		
		flock.emitter.add(new fk.particle.RandomEmit())

		// flock.emitter.add(new fk.particle.Behaviour.extend({
		// 	prepare: function() {},
		// 	apply: function(p, dt) {
		// 		
		// 	}
		// }));
		
		flock.add(new fk.particle.Gravity())
		
		flock.add(new fk.particle.Wrap(ps))
		
		// draw methods
		function draw() {
			ps.update();
			
			var g = context;
			g.clearRect(0, 0, width, height)
			g.lineWidth = 2
			g.strokeStyle = '#000000'
			
			var x = 0, y = 0, s = 0, r = 0;
			var p = null;

			// fk.info("ps.flocks.length: "+ ps.flocks.length +" flock.particles.length: "+ ps.flocks[0].particles.length);
			
			for(var i=0; i< ps.flocks.length; i++) {
				var flock = ps.flocks[i]

				for(var j=0; j<flock.particles.length; j++) {
					p = flock.particles[j]
					
					// fk.info("drawing particle at "+ p.position.x +" "+ p.position.y)
					g.save();
					g.translate(p.position.x,p.position.y);
					// g.rotate(p.rotation);
					g.fillRect(0, 0, p.size, p.size);
					g.restore();
				}
			}
			
			// var x = width/2
			// 		var y = height/2
			// 		var s = 50
			// 
			// 		var alpha = -Math.atan2(mouseX - x, mouseY - y)
			// 		
			//  			theta = fk.math.slerpAngle(theta, alpha, 0.1)
			// 					
			// 		var g = context
			// 		g.clearRect(0, 0, width, height)
			// 		g.lineWidth = 2
			// 		
			// 		g.strokeStyle = '#00ff00'
			// 		
			// 		g.save()
			// 		g.translate(x, y)
			// 		g.rotate(alpha)
			// 
			// 		g.beginPath()
			// 		g.moveTo(-s, 0)					
			// 		g.lineTo(0, s*4)
			// 		g.lineTo(s, 0)
			// 		g.stroke()
			// 		g.closePath()
			// 		g.restore()
			// 		
			// 		// draw slerped triangle
			// 		g.strokeStyle = '#ff0000'
			// 		
			// 		g.save()
			// 		g.translate(x, y)
			// 		g.rotate(theta)
			// 
			// 		g.beginPath()
			// 		g.moveTo(-s, 0)					
			// 		g.lineTo(0, s*4)
			// 		g.lineTo(s, 0)
			// 		g.stroke()
			// 		g.closePath()
			// 		g.restore()
		}
		
		setInterval(draw, 1000/60)
	</script>
  </body>
</html>